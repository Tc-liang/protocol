syntax = "proto3";
package openim.auth;

option go_package = "github.com/openimsdk/protocol/auth";

// ======== Requests & Responses ========

message GetAdminTokenReq {
  string secret = 1;
  string userID = 3;
}
message GetAdminTokenResp {
  string token = 2;
  int64 expireTimeSeconds = 3;
}

message ForceLogoutReq {
  int32 platformID = 1;
  string userID = 2;
}
message ForceLogoutResp {}

message ParseTokenReq {
  string token = 1;
}
message ParseTokenResp {
  string userID = 1;
  int32 platformID = 2;
  int64 expireTimeSeconds = 4;
}

message GetUserTokenReq {
  int32 platformID = 1;
  string userID = 2;
}

message GetUserTokenResp {
  string token = 1;
  int64 expireTimeSeconds = 2;
}

message InvalidateTokenReq {
  string preservedToken = 1;
  string userID = 2;
  int32 platformID = 3;
}
message InvalidateTokenResp {}

message KickTokensReq {
  repeated string tokens = 1;
}
message KickTokensResp {}

message GetExistingTokenReq {
  string userID = 1;
  int32 platformID = 2;
}

message GetExistingTokenResp {
  map<string, int32> tokenStates = 1;
}


// ======== Service ========

service AuthService {
  // Generate token
  rpc getAdminToken(GetAdminTokenReq) returns (GetAdminTokenResp);

  // Admin retrieves user token
  rpc getUserToken(GetUserTokenReq) returns (GetUserTokenResp);

  // Force logout
  rpc forceLogout(ForceLogoutReq) returns (ForceLogoutResp);

  // Parse token
  rpc parseToken(ParseTokenReq) returns (ParseTokenResp);

  // Invalidate or mark the token as kicked out
  rpc invalidateToken(InvalidateTokenReq) returns (InvalidateTokenResp);

  // Kick tokens
  rpc kickTokens(KickTokensReq) returns (KickTokensResp);

  // Get existing token
  rpc getExistingToken(GetExistingTokenReq) returns (GetExistingTokenResp);
}
