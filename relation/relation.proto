// Copyright © 2023 OpenIM. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";
package openim.relation;

import "sdkws/sdkws.proto";
import "wrapperspb/wrapperspb.proto";

option go_package = "github.com/openimsdk/protocol/relation";

option java_multiple_files = true;
option java_outer_classname = "IMFriendServiceOuterClass";


message GetPaginationFriendsReq {
  openim.sdkws.RequestPagination pagination = 1;
  string userID = 2;
}
message GetPaginationFriendsResp {
  repeated openim.sdkws.FriendInfo friendsInfo = 1;
  int32 total = 2;
}

message ApplyToAddFriendReq {
  string fromUserID = 1;
  string toUserID = 2;
  string reqMsg = 3;
  string ex = 4;
}
message ApplyToAddFriendResp {}

message FriendInfo {
  string ownerUserID = 1;
  string friendUserID = 2;
  string friendNickname = 3;
  string friendFaceURL = 4;
  string remark = 5;
  int64 createTime = 6;
  int32 addSource = 7;
  string operatorUserID = 8;
  string ex = 9;
  bool isPinned = 10;
}

message ImportFriendReq {
  string ownerUserID = 1;
  repeated string friendUserIDs = 2;
}

message ImportFriendResp {}

message GetPaginationFriendsApplyToReq {
  string userID = 1;
  openim.sdkws.RequestPagination pagination = 2;
  repeated int32 handleResults = 3;
}
message GetPaginationFriendsApplyToResp {
  repeated openim.sdkws.FriendRequest friendRequests = 1;
  int32 total = 2;
}

message GetDesignatedFriendsApplyReq {
  string fromUserID = 1;
  string toUserID = 2;
}

message GetDesignatedFriendsApplyResp {
  repeated openim.sdkws.FriendRequest friendRequests = 1;
}

message GetSelfUnhandledApplyCountReq {
  string userID = 1;
  int64 time = 2;
}

message GetSelfUnhandledApplyCountResp {
  int64 count = 1;
}

message GetIncrementalFriendsApplyToReq {
  string userID = 1;
  string versionID = 2;
  uint64 version = 3;
}
message GetIncrementalFriendsApplyToResp {
  uint64 version = 1;
  string versionID = 2;
  bool full = 3;
  repeated string delete_user_ids = 4; // 建议 snake_case，但原字段名是 deleteUserIds，可保留或改
  repeated openim.sdkws.FriendRequest changes = 5;
}

message GetIncrementalFriendsApplyFromReq {
  string userID = 1;
  string versionID = 2;
  uint64 version = 3;
}
message GetIncrementalFriendsApplyFromResp {
  uint64 version = 1;
  string versionID = 2;
  bool full = 3;
  repeated string delete_user_ids = 4;
  repeated openim.sdkws.FriendRequest changes = 5;
}

message GetDesignatedFriendsReq {
  string ownerUserID = 1;
  repeated string friendUserIDs = 2;
}
message GetDesignatedFriendsResp {
  repeated openim.sdkws.FriendInfo friendsInfo = 1;
}

message AddBlackReq {
  string ownerUserID = 1;
  string blackUserID = 2;
  string ex = 3;
}
message AddBlackResp {}

message RemoveBlackReq {
  string ownerUserID = 1;
  string blackUserID = 2;
}
message RemoveBlackResp {}

message GetPaginationBlacksReq {
  string userID = 1;
  openim.sdkws.RequestPagination pagination = 2;
}
message GetPaginationBlacksResp {
  repeated openim.sdkws.BlackInfo blacks = 1;
  int32 total = 2;
}

message IsFriendReq {
  string userID1 = 1;
  string userID2 = 2;
}
message IsFriendResp {
  bool inUser1Friends = 1;
  bool inUser2Friends = 2;
}

message IsBlackReq {
  string userID1 = 1;
  string userID2 = 2;
}
message IsBlackResp {
  bool inUser1Blacks = 1;
  bool inUser2Blacks = 2;
}

message DeleteFriendReq {
  string ownerUserID = 1;
  string friendUserID = 2;
}
message DeleteFriendResp {}

message RespondFriendApplyReq {
  string fromUserID = 1;
  string toUserID = 2;
  int32 handleResult = 3;
  string handleMsg = 4;
}

message RespondFriendApplyResp {}

message UpdateFriendsReq {
  string ownerUserID = 1;
  repeated string friendUserIDs = 2;
  openim.protobuf.BoolValue isPinned = 3;
  openim.protobuf.StringValue remark = 4;
  openim.protobuf.StringValue ex = 5;
}
message UpdateFriendsResp {}

message SetFriendRemarkReq {
  string ownerUserID = 1;
  string friendUserID = 2;
  string remark = 3;
}
message SetFriendRemarkResp {}

message GetPaginationFriendsApplyFromReq {
  string userID = 1;
  openim.sdkws.RequestPagination pagination = 2;
  repeated int32 handleResults = 3;
}
message GetPaginationFriendsApplyFromResp {
  repeated openim.sdkws.FriendRequest friendRequests = 1;
  int32 total = 2;
}

message GetFriendIDsReq {
  string userID = 1;
}

message GetFriendIDsResp {
  repeated string friendIDs = 1;
}

message GetSpecifiedFriendsInfoReq {
  string ownerUserID = 1;
  repeated string userIDList = 2;
}

message GetSpecifiedFriendsInfoInfo {
  openim.sdkws.UserInfo userInfo = 1;
  openim.sdkws.FriendInfo friendInfo = 2;
  openim.sdkws.BlackInfo blackInfo = 3;
}

message GetSpecifiedFriendsInfoResp {
  repeated GetSpecifiedFriendsInfoInfo infos = 1;
}

message GetIncrementalFriendsReq {
  string userID = 1;
  string versionID = 2;
  uint64 version = 3;
}

message GetIncrementalFriendsResp {
  uint64 version = 1;
  string versionID = 2;
  bool full = 3;
  repeated string delete = 4;
  repeated openim.sdkws.FriendInfo insert = 5;
  repeated openim.sdkws.FriendInfo update = 6;
  uint64 sortVersion = 7;
}

message GetIncrementalBlacksReq {
  string userID = 1;
  string versionID = 2;
  uint64 version = 3;
}
message GetIncrementalBlacksResp {
  uint64 version = 1;
  string versionID = 2;
  bool full = 3;
  repeated string delete = 4;
  repeated openim.sdkws.BlackInfo insert = 5;
  repeated openim.sdkws.BlackInfo update = 6;
}

message GetSpecifiedBlacksReq {
  string ownerUserID = 1;
  repeated string userIDList = 2;
}

message GetSpecifiedBlacksResp {
  repeated openim.sdkws.BlackInfo blacks = 1;
  int32 total = 2;
}

message GetFullFriendUserIDsReq {
  uint64 idHash = 1;
  string userID = 2;
}

message GetFullFriendUserIDsResp {
  uint64 version = 1;
  string versionID = 2;
  bool equal = 3;
  repeated string userIDs = 4;
}

message NotificationUserInfoUpdateReq {
  string userID = 1;
  openim.sdkws.UserInfo oldUserInfo = 2;
  openim.sdkws.UserInfo newUserInfo = 3;
}

message NotificationUserInfoUpdateResp {}

message FriendInfoOnly {
  string ownerUserID = 1;
  string friendUserID = 2;
  string remark = 3;
  int64 createTime = 4;
  int32 addSource = 5;
  string operatorUserID = 6;
  string ex = 7;
  bool isPinned = 8;
}

message GetFriendInfoReq {
  string ownerUserID = 1;
  repeated string friendUserIDs = 2;
}

message GetFriendInfoResp {
  repeated FriendInfoOnly friendInfos = 1;
}

service IMFriendService {
  rpc ApplyToAddFriend(ApplyToAddFriendReq) returns (ApplyToAddFriendResp);
  rpc GetPaginationFriendsApplyTo(GetPaginationFriendsApplyToReq) returns (GetPaginationFriendsApplyToResp);
  rpc GetPaginationFriendsApplyFrom(GetPaginationFriendsApplyFromReq) returns (GetPaginationFriendsApplyFromResp);
  rpc GetSelfUnhandledApplyCount(GetSelfUnhandledApplyCountReq) returns (GetSelfUnhandledApplyCountResp);
  rpc GetDesignatedFriendsApply(GetDesignatedFriendsApplyReq) returns (GetDesignatedFriendsApplyResp);
  rpc GetIncrementalFriendsApplyTo(GetIncrementalFriendsApplyToReq) returns (GetIncrementalFriendsApplyToResp);
  rpc GetIncrementalFriendsApplyFrom(GetIncrementalFriendsApplyFromReq) returns (GetIncrementalFriendsApplyFromResp);
  rpc AddBlack(AddBlackReq) returns (AddBlackResp);
  rpc RemoveBlack(RemoveBlackReq) returns (RemoveBlackResp);
  rpc IsFriend(IsFriendReq) returns (IsFriendResp);
  rpc IsBlack(IsBlackReq) returns (IsBlackResp);
  rpc GetPaginationBlacks(GetPaginationBlacksReq) returns (GetPaginationBlacksResp);
  rpc GetSpecifiedBlacks(GetSpecifiedBlacksReq) returns (GetSpecifiedBlacksResp);
  rpc DeleteFriend(DeleteFriendReq) returns (DeleteFriendResp);
  rpc RespondFriendApply(RespondFriendApplyReq) returns (RespondFriendApplyResp);
  rpc UpdateFriends(UpdateFriendsReq) returns (UpdateFriendsResp);
  rpc SetFriendRemark(SetFriendRemarkReq) returns (SetFriendRemarkResp);
  rpc ImportFriends(ImportFriendReq) returns (ImportFriendResp);
  rpc GetDesignatedFriends(GetDesignatedFriendsReq) returns (GetDesignatedFriendsResp);
  rpc GetPaginationFriends(GetPaginationFriendsReq) returns (GetPaginationFriendsResp);
  rpc GetFriendIDs(GetFriendIDsReq) returns (GetFriendIDsResp);
  rpc GetSpecifiedFriendsInfo(GetSpecifiedFriendsInfoReq) returns (GetSpecifiedFriendsInfoResp);
  rpc GetIncrementalFriends(GetIncrementalFriendsReq) returns (GetIncrementalFriendsResp);
  rpc GetIncrementalBlacks(GetIncrementalBlacksReq) returns (GetIncrementalBlacksResp);
  rpc GetFullFriendUserIDs(GetFullFriendUserIDsReq) returns (GetFullFriendUserIDsResp);
  rpc NotificationUserInfoUpdate(NotificationUserInfoUpdateReq) returns (NotificationUserInfoUpdateResp);
  rpc GetFriendInfo(GetFriendInfoReq) returns (GetFriendInfoResp);
}